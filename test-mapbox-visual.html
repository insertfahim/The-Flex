<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Mapbox API Visual Test</title>
        <script src="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js"></script>
        <link
            href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css"
            rel="stylesheet"
        />
        <style>
            body {
                margin: 0;
                padding: 20px;
                font-family: Arial, sans-serif;
                background-color: #f5f5f5;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
            }
            .header {
                text-align: center;
                margin-bottom: 30px;
                padding: 20px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .test-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
            }
            .test-item {
                background: white;
                padding: 20px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .map-container {
                grid-column: 1 / -1;
                height: 400px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }
            #map {
                width: 100%;
                height: 100%;
            }
            .status {
                display: inline-block;
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
            }
            .status.success {
                background-color: #d4edda;
                color: #155724;
            }
            .status.loading {
                background-color: #fff3cd;
                color: #856404;
            }
            .api-result {
                margin-top: 10px;
                padding: 10px;
                background-color: #f8f9fa;
                border-radius: 4px;
                font-size: 14px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="header">
                <h1>üó∫Ô∏è Mapbox API Visual Test</h1>
                <p>Testing API Key: <code>pk.eyJ1IjoiZmFoaW0wNi...</code></p>
            </div>

            <div class="test-grid">
                <div class="test-item">
                    <h3>üìç Geocoding Test</h3>
                    <span id="geocoding-status" class="status loading"
                        >Testing...</span
                    >
                    <div id="geocoding-result" class="api-result"></div>
                </div>

                <div class="test-item">
                    <h3>üõ£Ô∏è Directions Test</h3>
                    <span id="directions-status" class="status loading"
                        >Testing...</span
                    >
                    <div id="directions-result" class="api-result"></div>
                </div>

                <div class="test-item">
                    <h3>üñºÔ∏è Static Map Test</h3>
                    <span id="static-status" class="status loading"
                        >Testing...</span
                    >
                    <div id="static-result" class="api-result"></div>
                </div>

                <div class="test-item">
                    <h3>üîÑ Reverse Geocoding</h3>
                    <span id="reverse-status" class="status loading"
                        >Testing...</span
                    >
                    <div id="reverse-result" class="api-result"></div>
                </div>
            </div>

            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>

        <script>
            const MAPBOX_API_KEY =
                "pk.eyJ1IjoiZmFoaW0wNiIsImEiOiJjbWZqem8wbjUxMDFwMmpxdDFwanB4ODB0In0.H4_x_lN4g4p3YkNoZhp7dA";

            // Set mapbox access token
            mapboxgl.accessToken = MAPBOX_API_KEY;

            // Initialize map
            const map = new mapboxgl.Map({
                container: "map",
                style: "mapbox://styles/mapbox/streets-v12",
                center: [-0.1276, 51.5074], // London coordinates
                zoom: 12,
            });

            // Add navigation controls
            map.addControl(new mapboxgl.NavigationControl());

            // Add markers
            map.on("load", () => {
                // Add a marker for London
                new mapboxgl.Marker({ color: "#ff0000" })
                    .setLngLat([-0.1276, 51.5074])
                    .setPopup(new mapboxgl.Popup().setText("London, UK"))
                    .addTo(map);

                // Add a marker for Tower Bridge
                new mapboxgl.Marker({ color: "#0080ff" })
                    .setLngLat([-0.0753, 51.5055])
                    .setPopup(new mapboxgl.Popup().setText("Tower Bridge"))
                    .addTo(map);
            });

            // Test functions
            async function testGeocoding() {
                try {
                    const response = await fetch(
                        `https://api.mapbox.com/geocoding/v5/mapbox.places/Tower%20Bridge%20London.json?access_token=${MAPBOX_API_KEY}`
                    );
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        const place = data.features[0];
                        document.getElementById(
                            "geocoding-status"
                        ).textContent = "Success";
                        document.getElementById("geocoding-status").className =
                            "status success";
                        document.getElementById(
                            "geocoding-result"
                        ).innerHTML = `
                        <strong>Location:</strong> ${place.place_name}<br>
                        <strong>Coordinates:</strong> ${place.center[1].toFixed(
                            6
                        )}, ${place.center[0].toFixed(6)}
                    `;
                    }
                } catch (error) {
                    document.getElementById("geocoding-status").textContent =
                        "Failed";
                    document.getElementById("geocoding-result").textContent =
                        error.message;
                }
            }

            async function testDirections() {
                try {
                    const response = await fetch(
                        `https://api.mapbox.com/directions/v5/mapbox/driving/-0.1276,51.5074;-0.0753,51.5055?geometries=geojson&access_token=${MAPBOX_API_KEY}`
                    );
                    const data = await response.json();

                    if (data.routes && data.routes.length > 0) {
                        const route = data.routes[0];
                        document.getElementById(
                            "directions-status"
                        ).textContent = "Success";
                        document.getElementById("directions-status").className =
                            "status success";
                        document.getElementById(
                            "directions-result"
                        ).innerHTML = `
                        <strong>Distance:</strong> ${(
                            route.distance / 1000
                        ).toFixed(2)} km<br>
                        <strong>Duration:</strong> ${Math.round(
                            route.duration / 60
                        )} minutes
                    `;

                        // Add route to map
                        map.addSource("route", {
                            type: "geojson",
                            data: {
                                type: "Feature",
                                properties: {},
                                geometry: route.geometry,
                            },
                        });

                        map.addLayer({
                            id: "route",
                            type: "line",
                            source: "route",
                            layout: {
                                "line-join": "round",
                                "line-cap": "round",
                            },
                            paint: {
                                "line-color": "#3887be",
                                "line-width": 5,
                                "line-opacity": 0.75,
                            },
                        });
                    }
                } catch (error) {
                    document.getElementById("directions-status").textContent =
                        "Failed";
                    document.getElementById("directions-result").textContent =
                        error.message;
                }
            }

            async function testStaticMap() {
                try {
                    const staticMapUrl = `https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/pin-s-l+000(-0.1276,51.5074)/-0.1276,51.5074,12,0/300x200@2x?access_token=${MAPBOX_API_KEY}`;

                    const img = new Image();
                    img.onload = () => {
                        document.getElementById("static-status").textContent =
                            "Success";
                        document.getElementById("static-status").className =
                            "status success";
                        document.getElementById("static-result").innerHTML = `
                        <strong>Static Map Generated Successfully</strong><br>
                        <img src="${staticMapUrl}" style="max-width: 100%; border-radius: 4px; margin-top: 5px;">
                    `;
                    };
                    img.onerror = () => {
                        document.getElementById("static-status").textContent =
                            "Failed";
                        document.getElementById("static-result").textContent =
                            "Failed to load static map image";
                    };
                    img.src = staticMapUrl;
                } catch (error) {
                    document.getElementById("static-status").textContent =
                        "Failed";
                    document.getElementById("static-result").textContent =
                        error.message;
                }
            }

            async function testReverseGeocoding() {
                try {
                    const response = await fetch(
                        `https://api.mapbox.com/geocoding/v5/mapbox.places/-0.0753,51.5055.json?access_token=${MAPBOX_API_KEY}`
                    );
                    const data = await response.json();

                    if (data.features && data.features.length > 0) {
                        const place = data.features[0];
                        document.getElementById("reverse-status").textContent =
                            "Success";
                        document.getElementById("reverse-status").className =
                            "status success";
                        document.getElementById("reverse-result").innerHTML = `
                        <strong>Address:</strong> ${place.place_name}<br>
                        <strong>Place Type:</strong> ${
                            place.place_type?.[0] || "Unknown"
                        }
                    `;
                    }
                } catch (error) {
                    document.getElementById("reverse-status").textContent =
                        "Failed";
                    document.getElementById("reverse-result").textContent =
                        error.message;
                }
            }

            // Run tests when page loads
            window.addEventListener("load", () => {
                testGeocoding();
                testDirections();
                testStaticMap();
                testReverseGeocoding();
            });
        </script>
    </body>
</html>
